(("undefined"!==typeof self?self:this)["webpackJsonpnode_driver_1_0_0"]=("undefined"!==typeof self?self:this)["webpackJsonpnode_driver_1_0_0"]||[]).push([[2],{"480d":function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e._self._c;return t("div",[e.$fetchState.pending?t("Loading",{attrs:{delayed:!0}}):e._e(),e.errors.length?t("div",e._l(e.errors,(function(s,i){return t("div",{key:i},[t("Banner",{attrs:{color:"error",label:e.stringify(s)}})],1)})),0):e._e(),t("div",[t("div",{staticClass:"openstack-config"},[t("div",{staticClass:"title"},[e._v(" Openstack Configuration ")]),e.authenticating?t("div",{staticClass:"loading"},[t("i",{staticClass:"icon-spinner icon-spin icon-lg"}),t("span",[e._v(" Authenticating with the Openstack server ... ")])]):e._e()]),t("div",{staticClass:"row mt-10"},[t("div",{staticClass:"col span-6"},[t("LabeledSelect",{attrs:{label:"Flavor",options:e.flavors.options,disabled:!e.flavors.enabled||e.busy,loading:e.flavors.busy,searchable:!1},model:{value:e.flavors.selected,callback:function(t){e.$set(e.flavors,"selected",t)},expression:"flavors.selected"}})],1),t("div",{staticClass:"col span-6"},[t("LabeledSelect",{attrs:{label:"Image",options:e.images.options,disabled:!e.images.enabled||e.busy,loading:e.images.busy,searchable:!1},model:{value:e.images.selected,callback:function(t){e.$set(e.images,"selected",t)},expression:"images.selected"}})],1)]),t("div",{staticClass:"row mt-10"},[t("div",{staticClass:"col span-6"},[t("LabeledSelect",{attrs:{label:"Key Pair",options:e.keyPairs.options,disabled:!e.keyPairs.enabled||e.busy,loading:e.keyPairs.busy,searchable:!1},model:{value:e.keyPairs.selected,callback:function(t){e.$set(e.keyPairs,"selected",t)},expression:"keyPairs.selected"}})],1),t("div",{staticClass:"col span-6"},[t("LabeledInput",{attrs:{label:"Private Key",mode:e.mode,type:e.privateKeyFieldType,disabled:e.busy,required:!0},scopedSlots:e._u([{key:"suffix",fn:function(){return[t("div",{staticClass:"file-button"},[t("FileSelector",{staticClass:"btn-sm",attrs:{label:"...",mode:e.mode,"include-file":!0,disabled:e.busy},on:{selected:e.onPrivateKeyFileSelected}})],1)]},proxy:!0}]),model:{value:e.filename,callback:function(t){e.filename=t},expression:"filename"}})],1)]),t("div",{staticClass:"row mt-10"},[t("div",{staticClass:"col span-6"},[t("LabeledSelect",{attrs:{label:"Security Groups",options:e.securityGroups.options,disabled:!e.securityGroups.enabled||e.busy,loading:e.securityGroups.busy,searchable:!1},model:{value:e.securityGroups.selected,callback:function(t){e.$set(e.securityGroups,"selected",t)},expression:"securityGroups.selected"}})],1)]),t("div",{staticClass:"row mt-10"},[t("div",{staticClass:"col span-6"},[t("LabeledSelect",{attrs:{label:"Availability Zone",options:e.availabilityZones.options,disabled:!e.availabilityZones.enabled||e.busy,loading:e.availabilityZones.busy,searchable:!1},model:{value:e.availabilityZones.selected,callback:function(t){e.$set(e.availabilityZones,"selected",t)},expression:"availabilityZones.selected"}})],1)]),t("div",{staticClass:"row mt-10"},[t("div",{staticClass:"col span-6"},[t("LabeledSelect",{attrs:{label:"Floating IP Pools",options:e.floatingIpPools.options,disabled:!e.floatingIpPools.enabled||e.busy,loading:e.floatingIpPools.busy,searchable:!1},model:{value:e.floatingIpPools.selected,callback:function(t){e.$set(e.floatingIpPools,"selected",t)},expression:"floatingIpPools.selected"}})],1),t("div",{staticClass:"col span-6"},[t("LabeledSelect",{attrs:{label:"Networks",options:e.networks.options,disabled:!e.networks.enabled||e.busy,loading:e.networks.busy,searchable:!1},model:{value:e.networks.selected,callback:function(t){e.$set(e.networks,"selected",t)},expression:"networks.selected"}})],1)]),t("div",{staticClass:"row mt-10"},[t("div",{staticClass:"col span-6"},[t("LabeledInput",{attrs:{mode:e.mode,disabled:e.busy,required:!0,label:"SSH User ID"},model:{value:e.sshUser,callback:function(t){e.sshUser=t},expression:"sshUser"}})],1)])])],1)},a=[],o=s("15ca"),l=s("6418"),n=s("305c"),r=s("466b"),d=s("8e93"),c=s("907c"),u=s("3e9d"),h=s("da25"),p=function(){var e=this,t=e._self._c;return e.isView?e._e():t("button",{staticClass:"file-selector btn",attrs:{disabled:e.disabled,type:"button"},on:{click:e.selectFile}},[t("span",[e._v(e._s(e.label))]),t("input",{ref:"uploader",staticClass:"hide",attrs:{type:"file",multiple:e.multiple,webkitdirectory:e.directory},on:{change:e.fileChange}})])},v=[];s("e24b");var m={props:{label:{type:String,required:!0},mode:{type:String,default:h["b"]},disabled:{type:Boolean,default:!1},includeFileName:{type:Boolean,default:!1},showGrowlError:{type:Boolean,default:!0},multiple:{type:Boolean,default:!1},byteLimit:{type:Number,default:0},readAsDataUrl:{type:Boolean,default:!1},directory:{type:Boolean,default:!1},rawData:{type:Boolean,default:!1},includeFile:{type:Boolean,default:!1}},computed:{isView(){return this.mode===h["c"]}},methods:{selectFile(){this.$refs.uploader.value=null,this.$refs.uploader.click()},async fileChange(e){const t=e.target,s=Array.from(t.files||[]);if(this.byteLimit)for(const i of s)if(i.size>this.byteLimit)return void this.$emit("error",`${i.name} exceeds the file size limit of ${this.byteLimit} bytes`);if(this.rawData){const e=this.multiple||1!==s.length?s:s[0];this.$emit("selected",e)}else try{const e=s.map(this.getFileContents),t=await Promise.all(e),i=this.multiple||1!==t.length?t:t[0];if(this.includeFile)return this.$emit("selected",{file:this.multiple||1!==t.length?s:s[0],data:i});this.$emit("selected",i)}catch(u){this.$emit("error",u),this.showGrowlError&&this.$store.dispatch("growl/fromError",{title:"Error reading file",error:u},{root:!0})}},getFileContents(e){return new Promise((t,s)=>{const i=new FileReader;i.onload=s=>{const i=s.target.result,a=e.name,o=this.includeFileName?{value:i,name:a}:i;t(o)},i.onerror=e=>{s(e)},this.readAsDataUrl?i.readAsDataURL(e):i.readAsText(e)})}}},y=m,f=s("d802"),g=Object(f["a"])(y,p,v,!1,null,null,null),b=g.exports,k=s("f2d8");function w(){return{options:[],selected:null,busy:!1,enabled:!1}}var C={components:{Banner:l["a"],FileSelector:b,Loading:o["a"],LabeledInput:d["a"],LabeledSelect:r["a"]},mixins:[n["a"]],props:{uuid:{type:String,required:!0},cluster:{type:Object,default:()=>({})},credentialId:{type:String,required:!0},disabled:{type:Boolean,default:!1},busy:{type:Boolean,default:!1},provider:{type:String,required:!0}},async fetch(){if(this.errors=[],!this.credentialId)return;if(this.mode===h["c"])return void this.initForViewMode();try{this.credential=await this.$store.dispatch("rancher/find",{type:c["c"].CLOUD_CREDENTIAL,id:this.credentialId})}catch(t){this.credential=null}try{const e=this.credentialId.replace(":","/"),t=await this.$store.dispatch("management/find",{type:c["e"],id:e}),s=t.data["openstackcredentialConfig-password"],i=atob(s);this.password=i,this.havePassword=!0,this.ready=!0}catch(t){this.password="",this.havePassword=!1,console.error(t)}this.$set(this,"authenticating",!0);const e=new k["a"](this.$store,this.credential);e.password=this.password,this.os=e,this.os.getToken().then(t=>{var s,i,a,o,l,n,r;if(t.error)return this.$set(this,"authenticating",!1),this.$emit("validationChanged",!1),void this.errors.push("Unable to authenticate with the OpenStack server");this.$set(this,"authenticating",!1),e.getFlavors(this.flavors,null===(s=this.value)||void 0===s?void 0:s.flavorName),e.getImages(this.images,null===(i=this.value)||void 0===i?void 0:i.imageName),e.getKeyPairs(this.keyPairs,null===(a=this.value)||void 0===a?void 0:a.keypairName),e.getSecurityGroups(this.securityGroups,null===(o=this.value)||void 0===o?void 0:o.secGroups),e.getFloatingIpPools(this.floatingIpPools,null===(l=this.value)||void 0===l?void 0:l.floatingipPool),e.getNetworkNames(this.networks,null===(n=this.value)||void 0===n?void 0:n.netName),e.getAvailabilityZones(this.availabilityZones,null===(r=this.value)||void 0===r?void 0:r.availabilityZone)}),this.$emit("validationChanged",!1)},data(){var e,t,s;return{authenticating:!1,ready:!1,os:null,password:null,havePassword:!1,flavors:w(),images:w(),keyPairs:w(),securityGroups:w(),floatingIpPools:w(),networks:w(),availabilityZones:w(),sshUser:(null===(e=this.value)||void 0===e?void 0:e.sshUser)||"root",privateKeyFile:(null===(t=this.value)||void 0===t?void 0:t.privateKeyFile)||"",filename:null!==(s=this.value)&&void 0!==s&&s.privateKeyFile?"Private Key Provided":"",privateKeyFieldType:"password",errors:null}},watch:{credentialId(){this.$fetch()}},methods:{stringify:u["b"],initForViewMode(){var e,t,s,i,a,o,l;this.fakeSelectOptions(this.flavors,null===(e=this.value)||void 0===e?void 0:e.flavorName),this.fakeSelectOptions(this.images,null===(t=this.value)||void 0===t?void 0:t.imageName),this.fakeSelectOptions(this.keyPairs,null===(s=this.value)||void 0===s?void 0:s.keypairName),this.fakeSelectOptions(this.securityGroups,null===(i=this.value)||void 0===i?void 0:i.secGroups),this.fakeSelectOptions(this.floatingIpPools,null===(a=this.value)||void 0===a?void 0:a.floatingipPool),this.fakeSelectOptions(this.networks,null===(o=this.value)||void 0===o?void 0:o.netName),this.fakeSelectOptions(this.availabilityZones,null===(l=this.value)||void 0===l?void 0:l.availabilityZone)},fakeSelectOptions(e,t){e.busy=!1,e.enabled=!1,e.options=[],t&&e.options.push({label:t,value:t}),e.selected=t},onPrivateKeyFileSelected(e){this.filename=e.file.name,this.privateKeyFile=e.data,this.privateKeyFieldType="text",this.$emit("validationChanged",!0)},syncValue(){var e,t,s,i,a,o,l;this.value.authUrl=this.os.endpoint,this.value.domainName=this.os.domainName,this.value.tenantDomainName=this.os.projectDomainName,this.value.username=this.os.username,this.value.userDomainName=this.os.domainName,this.value.tenantId=this.os.projectId,this.value.tenantName=this.os.projectName,this.value.availabilityZone=null===(e=this.availabilityZones.selected)||void 0===e?void 0:e.name,this.value.flavorName=null===(t=this.flavors.selected)||void 0===t?void 0:t.name,this.value.imageName=null===(s=this.images.selected)||void 0===s?void 0:s.name,this.value.floatingipPool=null===(i=this.floatingIpPools.selected)||void 0===i?void 0:i.name,this.value.keypairName=null===(a=this.keyPairs.selected)||void 0===a?void 0:a.name,this.value.netName=null===(o=this.networks.selected)||void 0===o?void 0:o.name,this.value.secGroups=null===(l=this.securityGroups.selected)||void 0===l?void 0:l.name,this.value.sshUser=this.sshUser,this.value.privateKeyFile=this.privateKeyFile,this.value.region=this.os.region,this.value.endpointType="publicURL",this.value.insecure=!0,this.value.bootFromVolume=!1,this.value.sshPort="22"},test(){this.syncValue()}}},P=C,N=(s("c934"),Object(f["a"])(P,i,a,!1,null,"21bd070e",null));t["default"]=N.exports},"5fd9":function(e,t,s){var i=s("5eaa");t=i(!1),t.push([e.i,".file-button[data-v-21bd070e]{align-items:center;position:absolute;top:0;right:0;height:100%;display:flex}.file-button>.file-selector[data-v-21bd070e]{height:59px;border-top-left-radius:0;border-bottom-left-radius:0}.openstack-config[data-v-21bd070e]{display:flex;align-items:center}.openstack-config>.title[data-v-21bd070e]{font-weight:700;padding:4px 0}.openstack-config>.loading[data-v-21bd070e]{margin-left:20px;display:flex;align-items:center}.openstack-config>.loading>i[data-v-21bd070e]{margin-right:4px}",""]),e.exports=t},aef3:function(e,t,s){var i=s("5fd9");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[e.i,i,""]]),i.locals&&(e.exports=i.locals);var a=s("0ed3").default;a("41a0a8fd",i,!0,{sourceMap:!1,shadowMode:!1})},c934:function(e,t,s){"use strict";s("aef3")},dad7:function(e,t,s){var i={"./csp/metadata.json":"7f57","./federal/metadata.json":"66fa","./rgs/metadata.json":"45d2","./suse/metadata.json":"1d5f"};function a(e){var t=o(e);return s(t)}function o(e){if(!s.o(i,e)){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}return i[e]}a.keys=function(){return Object.keys(i)},a.resolve=o,e.exports=a,a.id="dad7"},f2d8:function(e,t,s){"use strict";s.d(t,"a",(function(){return i}));class i{constructor(e,t){this.domainName="",this.endpoint="",this.projectDomainName="",this.projectId="",this.projectName="",this.username="",this.password="",this.token="",this.region="",this.userId="",this.regionsFromCatalog=[],t.annotations?Object.keys(t.annotations).forEach(e=>{const s=e.split("/");if(2===s.length&&"openstack.cattle.io"===s[0]){const i=s[1];this[i]=t.annotations[e]}}):Object.keys(t).forEach(e=>{this[e]=t[e]}),this.$dispatch=e.dispatch}async getToken(){const e=this.endpoint.replace(/^https?:\/\//,""),t="/meta/proxy/"+e,s=t+"/auth/tokens",i={auth:{identity:{methods:["password"],password:{user:{name:this.username,domain:{name:this.domainName},password:this.password}}}}};this.projectName&&(i.auth.scope={project:{name:this.projectName,domain:{name:this.projectDomainName}}});const a={Accept:"application/json"};try{var o;const e=await this.$dispatch("management/request",{url:s,headers:a,method:"POST",redirectUnauthorized:!1,data:i},{root:!0});if(502===e._status)return{error:"Could not proxy request - URL may not be in Rancher's allow list"};const t=e._headers["x-subject-token"];return this.token=t,this.userId=null===e||void 0===e||null===(o=e.token)||void 0===o||null===(o=o.user)||void 0===o?void 0:o.id,this.regionsFromCatalog=[],i.auth.scope&&null!==e&&void 0!==e&&e.token&&(this.catalog=e.token.catalog,this.endpoints={},this.catalog.forEach(e=>{const t=e.endpoints.find(e=>"public"===e.interface);t&&t.region_id===this.region&&(this.endpoints[e.type]=t.url),t&&"compute"===e.type&&(this.regionsFromCatalog.includes(t.region_id)||this.regionsFromCatalog.push(t.region_id))})),this.regionsFromCatalog=this.regionsFromCatalog.map(e=>({id:e})),e}catch(l){return console.error(l),{error:l}}}async getFlavors(e,t){return await this.getOptions(e,"/flavors","flavors",void 0,t)}async getImages(e,t){return await this.getOptions(e,"/images/detail","images",void 0,t)}async getKeyPairs(e,t){return await this.getOptions(e,"/os-keypairs","keypairs",e=>e.keypair,t)}async getSecurityGroups(e,t){return await this.getOptions(e,"/os-security-groups","security_groups",void 0,t)}async getFloatingIpPools(e,t){return await this.getOptions(e,"/os-floating-ip-pools","floating_ip_pools",void 0,t)}async getNetworkNames(e,t){return await this.getOptions(e,"/os-tenant-networks","networks",e=>({...e,name:e.label}),t)}async getAvailabilityZones(e,t){return await this.getOptions(e,"/os-availability-zone","availabilityZoneInfo",e=>({...e,name:e.zoneName}),t)}async getOptions(e,t,s,i,a){e.busy=!0,e.enabled=!0,e.selected="";const o=await this.makeComputeRequest(t);if(o&&o[s]){let t=o[s]||[];if(i&&(t=t.map(e=>i(e))),e.options=this.convertToOptions(t),e.busy=!1,a){const t=e.options.find(e=>e.value.name===a);t&&(e.selected=t.value)}!e.selected&&e.options.length>0&&(e.selected=e.options[0].value)}else e.options=[],e.selected=null,e.busy=!1,e.enabled=!1}async makeComputeRequest(e){const t=this.endpoints["compute"].replace(/^https?:\/\//,""),s="/meta/proxy/"+t,i=`${s}${e}`,a={Accept:"application/json","X-Auth-Token":this.token};try{const e=await this.$dispatch("management/request",{url:i,headers:a,method:"GET",redirectUnauthorized:!1},{root:!0});return e}catch(o){console.error(o)}}async getProjects(){const e=this.endpoint.replace(/^https?:\/\//,""),t="/meta/proxy/"+e,s={Accept:"application/json","X-Auth-Token":this.token};try{const e=await this.$dispatch("management/request",{url:`${t}/users/${this.userId}/projects`,headers:s,method:"GET",redirectUnauthorized:!1},{root:!0});return null===e||void 0===e?void 0:e.projects}catch(i){return console.error(i),{error:i}}}async getRegions(){const e=this.endpoint.replace(/^https?:\/\//,""),t="/meta/proxy/"+e,s={Accept:"application/json","X-Auth-Token":this.token};try{const e=await this.$dispatch("management/request",{url:t+"/regions",headers:s,method:"GET",redirectUnauthorized:!1},{root:!0});return null===e||void 0===e?void 0:e.regions}catch(i){return console.error(i),{error:i}}}convertToOptions(e){const t=(e||[]).sort((e,t)=>e.name.localeCompare(t.name));return t.map(e=>({label:e.name,value:e}))}}}}]);
//# sourceMappingURL=node-driver-1.0.0.umd.min.machine-config.js.map